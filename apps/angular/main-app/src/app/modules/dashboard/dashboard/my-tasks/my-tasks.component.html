<div class="my-task-in-wrapper">
    <div class="top-proj-filter-container">
        <label for="tasks" class="proj-label dashboard-medium-heading">My Task(s) <ng-container *ngIf="totalTaskCount">({{ totalTaskCount }})</ng-container></label
    >
    <!-- <main-app-project-selection
      [projectList]="projectSelectionInputList"
      [selctedProjects]="projectSelection"
      (getSelectedProjects)="getSelectedProjectList($event)"
    ></main-app-project-selection> -->
    <workspace-grouped-project-selection
      [prefName]="prefStorageName"
      (getSelectedProjects)="getSelectedProjects($event)"
    ></workspace-grouped-project-selection>
  </div>

  <mat-tab-group
    (selectedTabChange)="getMyTasksList($event)"
    mat-stretch-tabs="false"
    animationDuration="0ms"
    class="task-tab-wrapper tab-main-wrapper"
    [disableRipple]="true"
  >
    <mat-tab label="In Progress">
      <ng-template matTabContent>
        <ng-container *ngIf="showSpinner">
          <div [mainAppSpinner]="showSpinner"></div>
        </ng-container>
        <ng-container *ngIf="hasTasksInState('inprogress') && !showSpinner; else noRecordsFound">
          <ng-container *ngIf="isMyTeamtasksHidden; else commonBody">
            <ng-container *ngTemplateOutlet="commonBody1"></ng-container>
          </ng-container>
        </ng-container>
      </ng-template>
    </mat-tab>
    <mat-tab label="To Do" [disableRipple]="true">
      <ng-template matTabContent>
        <ng-container *ngIf="showSpinner">
          <div [mainAppSpinner]="showSpinner"></div>
        </ng-container>
        <ng-container *ngIf="hasTasksInState('todo') && !showSpinner; else noRecordsFound">
          <ng-container *ngIf="isMyTeamtasksHidden; else commonBody">
            <ng-container *ngTemplateOutlet="commonBody1"></ng-container>
          </ng-container>
        </ng-container>
      </ng-template>
    </mat-tab>

    <mat-tab label="On Hold">
      <ng-template matTabContent>
        <ng-container *ngIf="showSpinner">
          <div [mainAppSpinner]="showSpinner"></div>
        </ng-container>
        <ng-container *ngIf="hasTasksInState('onhold') && !showSpinner; else noRecordsFound">
          <ng-container *ngIf="isMyTeamtasksHidden; else commonBody">
            <ng-container *ngTemplateOutlet="commonBody1"></ng-container>
          </ng-container>
        </ng-container>
      </ng-template>
    </mat-tab>

    <mat-tab label="Completed">
      <ng-template mat-tab-label>
        Completed
        <mat-icon
          *ngIf="doShowCompletedBadge"
          style="position: absolute; margin-left: 70px; margin-bottom: 7px; color: red; font-size: 10px; margin-top: 5px"
          >fiber_manual_record</mat-icon
        >
      </ng-template>
      <ng-template matTabContent>
        <ng-container *ngIf="showSpinner">
          <div [mainAppSpinner]="showSpinner"></div>
        </ng-container>
        <ng-container *ngIf="hasTasksInState('completed') && !showSpinner; else noRecordsFound">
          <ng-container *ngIf="isMyTeamtasksHidden; else commonBody">
            <ng-container *ngTemplateOutlet="commonBody1"></ng-container>
          </ng-container>
        </ng-container>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- This template used for common body -->

<ng-template #commonBody>
  <div class="task-table-wrapper">
    <div class="task-table-wrapper-inner">
      <table class="task-table">
        <tbody class="task-table-inner">
          <tr
            *ngFor="let task of myAllTasksList"
            class="task-row"
            [ngStyle]="{
              background: task?._other_user_working_status ? '#FFF6EA' : task?._user_working_status ? '#daeefe' : getTaskBackgroundForCompleted(task)
            }"
          >
            <td class="task-left-info">
              <div class="task-left-info-inner">
                <img [matTooltip]="task.priority" [src]="'assets/images/' + task.priorityImg" [alt]="task.priority + ' Priority'" />
                <div class="task-cell task-key" *ngIf="task?.task_key_prefix && task?.task_unique_key" [matTooltip]="task?.project_name">
                  {{ task?.task_key_prefix + '-' + task?.task_unique_key }}
                </div>
                <div class="task-cell task-key" *ngIf="!(task?.task_key_prefix && task?.task_unique_key) && task?.task_key" [matTooltip]="task?.project_name">
                  {{ task?.task_key }}
                </div>
                <div [matTooltip]="task?.type" class="task-cell task-color" [ngStyle]="{ 'background-color': task.taskTypeIndicator }"></div>
                <div class="task-cell task-type">
                  <img
                    matTooltip="Copy link"
                    src="/assets/images/copy_task.svg"
                    class="cpy-task-link-img"
                    alt="copy_link"
                    (click)="copyTaskLink(task.id)"
                  />
                </div>
                <!-- (click)="navigateToTaskDetail(task?.id)" -->
                <a
                  class="task-cell task-name"
                  [matTooltip]="task?.title || ''"
                  [routerLink]="['/tasks/view', EncryptId(task?.id)]"
                  [queryParams]="{ r_url: 'dashboard' }"
                >
                  {{ task?.title || '--' }}
                </a>
              </div>
            </td>
            <td class="task-right-info">
              <div class="task-right-info-inner">
                <div class="task-cell worked-hours" *ngIf="task.state.toLowerCase() !== 'completed'">
                  <span *ngIf="timerStartedTaskId === task.id">{{ timerCount }} </span>
                  <span *ngIf="timerStartedTaskId !== task.id"> 00:00 </span>
                </div>
                <div
                  class="task-cell timer"
                  [ngClass]="{ 'not-allowed-cursor': task.state.toLowerCase() === 'completed' || userIsIntBreak }"
                  *ngIf="task.state.toLowerCase() !== 'completed'"
                >
                  <img
                    src="assets/images/play.svg"
                    matTooltip="Start task"
                    class="cursor-pointer"
                    *ngIf="!task._user_working_status"
                    (click)="toogleTimer(task)"
                    [ngClass]="{ 'disable-item': task.state.toLowerCase() === 'completed' || userIsIntBreak }"
                  />
                  <img
                    src="assets/images/pause.svg"
                    matTooltip="Stop task"
                    class="cursor-pointer"
                    *ngIf="task._user_working_status"
                    (click)="toogleTimer(task)"
                    [ngClass]="{ 'disable-item': task.state.toLowerCase() === 'completed' || userIsIntBreak }"
                  />
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 18 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    matTooltip="Work in progress"
                    *ngIf="task._other_user_working_status"
                    (click)="getWorkingUsers(task)"
                    [matMenuTriggerFor]="userWorkingList"
                    class="cursor-pointer"
                  >
                    <path
                      d="M13.4996 5.37C13.4546 5.3625 13.4021 5.3625 13.3571 5.37C12.3221 5.3325 11.4971 4.485 11.4971 3.435C11.4971 2.3625 12.3596 1.5 13.4321 1.5C14.5046 1.5 15.3671 2.37 15.3671 3.435C15.3596 4.485 14.5346 5.3325 13.4996 5.37Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M12.7266 10.8301C13.7541 11.0026 14.8866 10.8226 15.6816 10.2901C16.7391 9.58512 16.7391 8.43012 15.6816 7.72512C14.8791 7.19262 13.7316 7.01262 12.7041 7.19262"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M4.47785 5.37C4.52285 5.3625 4.57535 5.3625 4.62035 5.37C5.65535 5.3325 6.48035 4.485 6.48035 3.435C6.48035 2.3625 5.61785 1.5 4.54535 1.5C3.47285 1.5 2.61035 2.37 2.61035 3.435C2.61785 4.485 3.44285 5.3325 4.47785 5.37Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M5.25008 10.8301C4.22258 11.0026 3.09008 10.8226 2.29508 10.2901C1.23758 9.58512 1.23758 8.43012 2.29508 7.72512C3.09758 7.19262 4.24508 7.01262 5.27258 7.19262"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8.99957 10.9725C8.95457 10.965 8.90207 10.965 8.85707 10.9725C7.82207 10.935 6.99707 10.0875 6.99707 9.03754C6.99707 7.96504 7.85957 7.10254 8.93207 7.10254C10.0046 7.10254 10.8671 7.97254 10.8671 9.03754C10.8596 10.0875 10.0346 10.9425 8.99957 10.9725Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M6.81754 13.335C5.76004 14.04 5.76004 15.195 6.81754 15.9C8.01754 16.7025 9.98254 16.7025 11.1825 15.9C12.24 15.195 12.24 14.04 11.1825 13.335C9.99004 12.54 8.01754 12.54 6.81754 13.335Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <mat-menu
                    #userWorkingList="matMenu"
                    yPosition="below"
                    class="dropdown-border-input-wrapper assignee-dropdown multi-user-icon-dropdown"
                  >
                    <div class="assignee-list-wrapper dropdown-border-listing-wrapper">
                      <ng-container *ngFor="let user of task?.userDetails">
                        <main-app-mat-chips
                          [indicateUserWorkingLocation]="true"
                          *ngIf="user && user.id !== loggedinUserid"
                          [data]="user"
                          [isCloseButton]="false"
                          [stopViewFullProfileOption]="true"
                          class="assignee-list"
                        >
                        </main-app-mat-chips>
                      </ng-container>
                    </div>
                  </mat-menu>
                </div>
                <div class="task-right-info-child">
                  <div class="task-cell estimated-hours">{{ task.total_worked_hours || '00h 00m' }}&nbsp;/&nbsp;</div>
                  <div class="task-cell worked-hours">
                    {{ task.eta || '00' }}
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</ng-template>
<ng-template #commonBody1>
  <div class="my-task-table-wrapper-outer">
    <table class="my-task-table-wrapper">
      <thead>
        <tr>
          <th class="title-wrapper align-left">Title</th>
          <!-- <th>Status</th> -->
          <!-- <th class="priority-wrapper">Priority</th> -->
          <th class="project-wrapper">Project</th>
          <th class="label-wrapper-th">Labels</th>
          <th class="assignee-wrapper-th">Assignee</th>
          <th class="due-wrapper">Due Date</th>
          <th class="eta-wrapper">ETA</th>
          <th class="time-wrapper">Time Worked</th>
          <th class="clock-wrapper"></th>
        </tr>
      </thead>
      <tbody [mainAppSpinner]="myAllTasksList && !myAllTasksList.length ? true : false">
        <tr
          *ngFor="let task of myAllTasksList"
          class="task-row"
          [ngStyle]="{
            background: task?._other_user_working_status
              ? '#FFF6EA'
              : task?._user_working_status
              ? '#F3F7FD'
              : currentTaskIdToEdit === task?.id
              ? 'rgba(230, 229, 229, 0.37)'
              : getTaskBackgroundForCompleted(task)
          }"
        >
          <td class="left">
            <div class="task-name-wrapper">
              <!-- Priority Starts -->
              <span
                class="cursor-pointer"
                [ngClass]="permissionDetails.allowUpdate && permissionDetails.priority.edit ? '' : 'disable-item-container'"
              >
                <img
                  [matMenuTriggerFor]="priorityMenu"
                  (click)="currentTaskIdToEdit = task?.id"
                  [ngClass]="permissionDetails.allowUpdate && permissionDetails.priority.edit ? '' : 'disable-item'"
                  [src]="'assets/images/' + task.priorityImg"
                  [alt]="task.priority + ' Priority'"
                  [matTooltip]="task.priority"
                  (error)="img.src = 'assets/images/flag.svg'"
                  #img
                />
                <mat-menu
                  (closed)="currentTaskIdToEdit = null"
                  #priorityMenu="matMenu"
                  yPosition="below"
                  class="priority-menu-wrapper dropdown-border-input-wrapper"
                >
                  <div
                    class="prirority-dropdown-list"
                    mat-menu-item
                    *ngFor="let priority of priorityList; let i = index"
                    (click)="onPriorityChange(priority, task)"
                  >
                    <img [src]="'assets/images/' + priority.priorityImg" />
                    <span class="priority-name">{{ priority.name }}</span>
                  </div>
                  <div class="prirority-dropdown-list" mat-menu-item (click)="clearPriority(task)">
                    <img [src]="'assets/images/clear.svg'" />
                    <span class="priority-name">Clear</span>
                  </div>
                </mat-menu>
              </span>
              <!-- Priority Ends -->
              <span class="task-key">{{ task?.task_key }}</span>
              <!-- Task Type Starts -->
              <div [ngClass]="permissionDetails.allowUpdate && permissionDetails.taskType.edit ? '' : 'disable-item-container'">
                <div
                  [ngClass]="permissionDetails.allowUpdate && permissionDetails.taskType.edit ? '' : 'disable-item'"
                  [matMenuTriggerFor]="belowMenu"
                  [matTooltip]="task?.type"
                  class="task-cell task-color cursor-pointer"
                  [ngStyle]="{ 'background-color': task.taskTypeIndicator }"
                  (click)="currentTaskIdToEdit = task?.id"
                ></div>
                <mat-menu
                  (closed)="currentTaskIdToEdit = null"
                  #belowMenu="matMenu"
                  yPosition="below"
                  class="task-menu-wrapper dropdown-border-input-wrapper"
                >
                  <div
                    mat-menu-item
                    *ngFor="let taskTypeObject of taskTypeList | keyvalue; let i = index"
                    (click)="onTaskTypeChange(taskTypeObject, task)"
                  >
                    <span>{{ taskTypeObject.key }}</span>
                  </div>
                </mat-menu>
              </div>
              <!-- Task type Ends -->
              <div class="task-cell task-info">
                <!--{{ transformStatus(task.state) }}-->
              </div>
              <div class="task-cell">
                <img
                  matTooltip="Copy link"
                  src="/assets/images/copy_task.svg"
                  class="cpy-task-link-img"
                  alt="copy_link"
                  (click)="copyTaskLink(task.id)"
                />
              </div>
              <!-- (click)="navigateToTaskDetail(task?.id)" -->
              <a
                class="task-cell task-name task-info"
                [matTooltip]="task?.title || ''"
                [routerLink]="['/tasks/view', EncryptId(task?.id)]"
                [queryParams]="{ r_url: 'dashboard' }"
              >
                {{ task?.title || '--' }}
              </a>
            </div>
          </td>

          <td class="center">
            <div class="task-cell task-info">
              {{ task?.project_name || '--' }}
            </div>
          </td>
          <!-- Labels Starts -->
          <td class="center" [ngClass]="permissionDetails.allowUpdate && permissionDetails.labels.edit ? '' : 'disable-item-container'">
            <div class="task-cell task-label-outer-wrapper">
              <span
                class="task-label-outer"
                [ngClass]="permissionDetails.allowUpdate && permissionDetails.labels.edit ? '' : 'disable-item'"
                cdkOverlayOrigin
                #triggerTaskLabels="cdkOverlayOrigin"
                (click)="editTaskLables(task)"
              >
                <div
                  *ngFor="let label of task?.task_labels?.slice(0, 1)"
                  class="task-info label-wrapper"
                  [ngStyle]="{ 'background-color': label?.color?.bgColor, color: label?.color?.color }"
                >
                  {{ label.title }}
                </div>
                <div *ngIf="!task?.task_labels || task?.task_labels?.length === 0">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M3.47532 12.7497L7.25032 16.5247C8.80032 18.0747 11.317 18.0747 12.8753 16.5247L16.5337 12.8663C18.0837 11.3163 18.0837 8.79967 16.5337 7.24134L12.7503 3.47467C11.9587 2.68301 10.867 2.25801 9.75032 2.31634L5.58365 2.51634C3.91698 2.59134 2.59198 3.91634 2.50865 5.57467L2.30865 9.74134C2.25865 10.8663 2.68365 11.958 3.47532 12.7497Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M7.91634 10.0002C9.06693 10.0002 9.99967 9.06742 9.99967 7.91683C9.99967 6.76624 9.06693 5.8335 7.91634 5.8335C6.76575 5.8335 5.83301 6.76624 5.83301 7.91683C5.83301 9.06742 6.76575 10.0002 7.91634 10.0002Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                    />
                  </svg>
                </div>
                <div class="count task-count" *ngIf="task?.task_labels?.length > 1">+{{ task?.task_labels?.length - 1 }}</div>
              </span>
            </div>

            <ng-template
              class="ios"
              cdkConnectedOverlay
              cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
              [cdkConnectedOverlayHasBackdrop]="true"
              [cdkConnectedOverlayOrigin]="triggerTaskLabels"
              [cdkConnectedOverlayOpen]="editLabels?.id === task?.id"
              (detach)="editLabels = null; saveLabels(task); currentTaskIdToEdit = null"
              (backdropClick)="editLabels = null; currentTaskIdToEdit = null"
            >
              <span class="task-right-label custom-overlay">
                <div class="section-menu-wrapper-outer">
                  <div
                    class="section-menu-wrapper-outer-inner"
                    [ngClass]="taskLabels.value && taskLabels.value.length > 0 ? '' : 'empty-labels-selection'"
                  >
                    <ng-container *ngIf="taskLabels.value && taskLabels.value.length > 0">
                      <span
                        *ngFor="let item of taskLabels.value"
                        [ngStyle]="{ 'background-color': item?.color?.bgColor, color: item?.color?.color }"
                        class="label-wrapper"
                      >
                        {{ item?.title || '' }}
                        <mat-icon (click)="$event.stopPropagation(); onRemoveTaskLabel(item)">cancel</mat-icon>
                      </span>

                      <span
                        [cpFallbackColor]="'#800101'"
                        [cpPresetColors]="presetColors"
                        [(cpToggle)]="toggle"
                        [(colorPicker)]="color"
                        (colorPickerChange)="onLabelColorChange($event)"
                      ></span>
                    </ng-container>
                  </div>

                  <tms-workspace-labels-popup
                    [placeHolder]="'Search or Create New'"
                    [isIntaskList]="true"
                    [listInput]="filteredAvailableLabels"
                    (itemEmmiter)="onTaskLabelSelect($event)"
                    [messageToCreateNewItem]="createLabelForMessage"
                    [hasSelctedLables]="((taskLabels && taskLabels.value?.length) || 0) > 0"
                  ></tms-workspace-labels-popup>
                </div>
              </span>
            </ng-template>
          </td>
          <!-- Labels Ends -->

          <!-- Assignee Starts -->
          <td class="center" [ngClass]="permissionDetails.allowUpdate && permissionDetails.assignee.edit ? '' : 'disable-item-container'">
            <!-- <div class="task-cell task-info assignee-wrapper-task"> -->
            <div
              class="assignee-wrapper-task"
              (mouseenter)="task?.assignee ? onMouseOverRemoveableItem(task, 1) : null"
              (mouseleave)="onMouseOutItem()"
            >
              <div
                [ngClass]="permissionDetails.allowUpdate && permissionDetails.assignee.edit ? '' : 'disable-item'"
                class="assignee-wrapper-task-inner"
                cdkOverlayOrigin
                #assigneeSelection="cdkOverlayOrigin"
                (click)="onClickAssignee(task); currentTaskIdToEdit = task?.id"
              >
                <main-app-mat-chips
                  [indicateUserWorkingLocation]="true"
                  [viewAvatarOnly]="true"
                  *ngIf="task?.assignee; else addAssignee"
                  [data]="task.task_assignee"
                  [isCloseButton]="false"
                  [stopViewFullProfileOption]="true"
                  [matTooltip]="
                    task.task_assignee?.name ? task.task_assignee?.name : task.task_assignee?.first_name + ' ' + task.task_assignee?.last_name
                  "
                  disableRipple
                >
                </main-app-mat-chips>
                <ng-template #addAssignee>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M9.54967 11.4416C10.8429 11.4416 11.8913 10.3932 11.8913 9.09997C11.8913 7.8067 10.8429 6.7583 9.54967 6.7583C8.25641 6.7583 7.20801 7.8067 7.20801 9.09997C7.20801 10.3932 8.25641 11.4416 9.54967 11.4416Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M13.8746 16.8331C13.8746 14.8915 11.9413 13.3081 9.54961 13.3081C7.15794 13.3081 5.22461 14.8831 5.22461 16.8331"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M17.5003 10.4167C17.5003 14.7917 13.9587 18.3333 9.58366 18.3333C5.20866 18.3333 1.66699 14.7917 1.66699 10.4167C1.66699 6.04167 5.20866 2.5 9.58366 2.5C10.6753 2.5 11.717 2.71666 12.667 3.11666C12.5587 3.44999 12.5003 3.8 12.5003 4.16667C12.5003 4.79167 12.6753 5.38333 12.9837 5.88333C13.1503 6.16666 13.367 6.42498 13.617 6.64164C14.2003 7.17498 14.9753 7.5 15.8337 7.5C16.2003 7.5 16.5503 7.44165 16.8753 7.32498C17.2753 8.27498 17.5003 9.325 17.5003 10.4167Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M19.1667 4.16683C19.1667 4.4335 19.1333 4.69182 19.0667 4.94182C18.9917 5.27516 18.8583 5.60016 18.6833 5.88349C18.2833 6.55849 17.6417 7.08348 16.875 7.32514C16.55 7.44181 16.2 7.50016 15.8333 7.50016C14.975 7.50016 14.2 7.17514 13.6167 6.6418C13.3667 6.42514 13.15 6.16683 12.9833 5.88349C12.675 5.38349 12.5 4.79183 12.5 4.16683C12.5 3.80016 12.5583 3.45015 12.6667 3.11682C12.825 2.63349 13.0917 2.20018 13.4417 1.84185C14.05 1.21685 14.9 0.833496 15.8333 0.833496C16.8167 0.833496 17.7083 1.25851 18.3083 1.94184C18.8417 2.53351 19.1667 3.31683 19.1667 4.16683Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M17.0751 4.15039H14.5918"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M15.833 2.93359V5.42525"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-miterlimit="10"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </ng-template>
              </div>
              <ng-template
                class="ios"
                cdkConnectedOverlay
                cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                [cdkConnectedOverlayHasBackdrop]="true"
                [cdkConnectedOverlayOrigin]="assigneeSelection"
                [cdkConnectedOverlayOpen]="assigneeSelectionTaskId === task.id"
                (detach)="assigneeSelectionTaskId = null; currentTaskIdToEdit = null"
                (backdropClick)="assigneeSelectionTaskId = null; currentTaskIdToEdit = null"
              >
                <div class="assignee-dropdown dropdown-border-input-wrapper">
                  <div class="input-wrapper">
                    <input type="text" placeholder="Assignee" (keyup)="onAssigneeSerchchanges($event)" tmsWorkspaceAutoFocusInput />
                    <img src="assets/images/search.svg" alt="search" class="search" />
                  </div>
                  <div class="assignee-list-wrapper dropdown-border-listing-wrapper">
                    <ng-container *ngFor="let teamMember of filteredAssigneeList">
                      <main-app-mat-chips
                        [indicateUserWorkingLocation]="true"
                        class="assignee-list"
                        [stopViewFullProfileOption]="true"
                        *ngIf="teamMember"
                        [data]="teamMember"
                        [isCloseButton]="false"
                        (click)="getSelectedResponsiblePerson(teamMember, task)"
                      ></main-app-mat-chips>
                    </ng-container>
                  </div>
                </div>
              </ng-template>
              <mat-icon
                *ngIf="
                  permissionDetails.allowUpdate &&
                  permissionDetails.assignee.edit &&
                  task?.assignee &&
                  displayAssigneeCloseIcon &&
                  hoverId === task.id
                "
                (click)="onMouseOutItem(); removeAssigneeFromTask(task)"
                class="filter-close"
                >close</mat-icon
              >
            </div>
            <!-- </div> -->
          </td>
          <!-- Assignee Ends -->
          <!-- Due Date Starts -->
          <td
            class="center assignee-outer-wrapper"
            [ngClass]="permissionDetails.allowUpdate && permissionDetails.dueDate.edit ? '' : 'disable-item-container'"
          >
            <span
              class="task-info"
              [ngStyle]="{ color: task.alertIndicate ? 'red' : '' }"
              (click)="dueDatePicker.open(); currentTaskIdToEdit = task?.id"
              *ngIf="task?.due_date; else setDueDate"
              [ngClass]="permissionDetails.allowUpdate && permissionDetails.dueDate.edit ? '' : 'disable-item'"
              >{{ task?.forMattedDueDate }}</span
            >
            <ng-template #setDueDate>
              <svg
                (click)="dueDatePicker.open(); currentTaskIdToEdit = task?.id"
                [ngClass]="permissionDetails.allowUpdate && permissionDetails.dueDate.edit ? '' : 'disable-item'"
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.66699 1.6665V4.1665"
                  stroke="#86969D"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M13.333 1.6665V4.1665"
                  stroke="#86969D"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M2.91699 7.5752H17.0837"
                  stroke="#86969D"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M17.5 7.08317V14.1665C17.5 16.6665 16.25 18.3332 13.3333 18.3332H6.66667C3.75 18.3332 2.5 16.6665 2.5 14.1665V7.08317C2.5 4.58317 3.75 2.9165 6.66667 2.9165H13.3333C16.25 2.9165 17.5 4.58317 17.5 7.08317Z"
                  stroke="#86969D"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path d="M13.0791 11.4167H13.0866" stroke="#86969D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M13.0791 13.9167H13.0866" stroke="#86969D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M9.99607 11.4167H10.0036" stroke="#86969D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M9.99607 13.9167H10.0036" stroke="#86969D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M6.91209 11.4167H6.91957" stroke="#86969D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M6.91209 13.9167H6.91957" stroke="#86969D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </ng-template>
            <input
              matInput
              [value]="task?.due_date || ''"
              class="hidden-date-picker-input"
              readonly
              [matDatepicker]="dueDatePicker"
              (dateChange)="updateDueDate($event, task)"
            />
            <mat-datepicker (closed)="currentTaskIdToEdit = null" #dueDatePicker></mat-datepicker>
          </td>
          <!-- Due Date Starts -->

          <!-- ETA Starts -->
          <td
            class="center eta-outer-wrapper"
            [ngClass]="permissionDetails.allowUpdate && permissionDetails.eta.edit ? '' : 'disable-item-container'"
          >
            <!-- <div class="task-cell worked-hours task-info"> -->
            <span
              class="eta-value-wrapper"
              [ngClass]="permissionDetails.allowUpdate && permissionDetails.eta.edit ? '' : 'disable-item'"
              (mouseenter)="task?.eta ? onMouseOverRemoveableItem(task, 2) : null"
              (mouseleave)="onMouseOutItem()"
            >
              <span
                (click)="toggleETAOverlay(task)"
                [ngClass]="permissionDetails.allowUpdate && permissionDetails.eta.edit ? '' : 'disable-item'"
                cdkOverlayOrigin
                #triggerETAOverlay="cdkOverlayOrigin"
              >
                <span class="task-info" *ngIf="task?.eta; else setEta"> {{ task?.eta }} </span>

                <ng-template #setEta>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M12.7002 1.6665H7.30019C4.16686 1.6665 3.92519 4.48317 5.61686 6.0165L14.3835 13.9832C16.0752 15.5165 15.8335 18.3332 12.7002 18.3332H7.30019C4.16686 18.3332 3.92519 15.5165 5.61686 13.9832L14.3835 6.0165C16.0752 4.48317 15.8335 1.6665 12.7002 1.6665Z"
                      stroke="#86969D"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </ng-template>
              </span>
              <!-- <mat-icon
                *ngIf="task?.eta && displayEtaCloseIcon && hoverId === task.id"
                (click)="onMouseOutItem(); removeEtaFromTask(task)"
                class="filter-close"
                >close</mat-icon
              > -->
              <ng-template
                cdkConnectedOverlay
                (overlayOutsideClick)="taskIdToUpdateETA = null; currentTaskIdToEdit = null"
                (detach)="taskIdToUpdateETA = null; currentTaskIdToEdit = null"
                (backdropClick)="taskIdToUpdateETA = null; currentTaskIdToEdit = null"
                [cdkConnectedOverlayOrigin]="triggerETAOverlay"
                [cdkConnectedOverlayOpen]="taskIdToUpdateETA === task.id"
                cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                [cdkConnectedOverlayHasBackdrop]="true"
              >
                <tms-workspace-eta-popup [ETAInput]="task?.eta || ''" (ETAEmmiter)="getSelectedETA($event, task)"></tms-workspace-eta-popup>
              </ng-template>
            </span>
            <!-- </div> -->
          </td>
          <!-- ETA Ends -->
          <td class="center">
            <div class="task-cell estimated-hours task-info" [ngStyle]="getStyleObject(task.eta, task.total_worked_hours)">
              {{ task.total_worked_hours || '00h 00m' }}
            </div>
          </td>
          <td class="right">
            <div class="timer-wrapper">
              <div class="task-cell task-info worked-hours">
                <span *ngIf="timerStartedTaskId === task.id">{{ timerCount }} </span>
                <span *ngIf="timerStartedTaskId !== task.id"> 00:00 </span>
              </div>
              <div class="task-cell task-info timer" [ngClass]="{ 'not-allowed-cursor': task.state.toLowerCase() === 'completed' || userIsIntBreak }">
                <img
                  src="assets/images/play.svg"
                  matTooltip="Start task"
                  class="cursor-pointer"
                  *ngIf="!task._user_working_status"
                  (click)="toogleTimer(task)"
                  [ngClass]="{ 'disable-item': task.state.toLowerCase() === 'completed' || userIsIntBreak }"
                />
                <img
                  src="assets/images/pause.svg"
                  matTooltip="Stop task"
                  class="cursor-pointer"
                  *ngIf="task._user_working_status"
                  (click)="toogleTimer(task)"
                  [ngClass]="{ 'disable-item': task.state.toLowerCase() === 'completed' || userIsIntBreak }"
                />
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  *ngIf="task._other_user_working_status"
                  [matMenuTriggerFor]="userWorkingList"
                  matTooltip="Work in progress"
                  (click)="getWorkingUsers(task)"
                >
                  <path
                    d="M13.4996 5.37C13.4546 5.3625 13.4021 5.3625 13.3571 5.37C12.3221 5.3325 11.4971 4.485 11.4971 3.435C11.4971 2.3625 12.3596 1.5 13.4321 1.5C14.5046 1.5 15.3671 2.37 15.3671 3.435C15.3596 4.485 14.5346 5.3325 13.4996 5.37Z"
                    stroke="#86969D"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M12.7266 10.8301C13.7541 11.0026 14.8866 10.8226 15.6816 10.2901C16.7391 9.58512 16.7391 8.43012 15.6816 7.72512C14.8791 7.19262 13.7316 7.01262 12.7041 7.19262"
                    stroke="#86969D"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M4.47785 5.37C4.52285 5.3625 4.57535 5.3625 4.62035 5.37C5.65535 5.3325 6.48035 4.485 6.48035 3.435C6.48035 2.3625 5.61785 1.5 4.54535 1.5C3.47285 1.5 2.61035 2.37 2.61035 3.435C2.61785 4.485 3.44285 5.3325 4.47785 5.37Z"
                    stroke="#86969D"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M5.25008 10.8301C4.22258 11.0026 3.09008 10.8226 2.29508 10.2901C1.23758 9.58512 1.23758 8.43012 2.29508 7.72512C3.09758 7.19262 4.24508 7.01262 5.27258 7.19262"
                    stroke="#86969D"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M8.99957 10.9725C8.95457 10.965 8.90207 10.965 8.85707 10.9725C7.82207 10.935 6.99707 10.0875 6.99707 9.03754C6.99707 7.96504 7.85957 7.10254 8.93207 7.10254C10.0046 7.10254 10.8671 7.97254 10.8671 9.03754C10.8596 10.0875 10.0346 10.9425 8.99957 10.9725Z"
                    stroke="#86969D"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M6.81754 13.335C5.76004 14.04 5.76004 15.195 6.81754 15.9C8.01754 16.7025 9.98254 16.7025 11.1825 15.9C12.24 15.195 12.24 14.04 11.1825 13.335C9.99004 12.54 8.01754 12.54 6.81754 13.335Z"
                    stroke="#86969D"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                <mat-menu
                  #userWorkingList="matMenu"
                  yPosition="below"
                  class="dropdown-border-input-wrapper assignee-dropdown multi-user-icon-dropdown"
                >
                  <div class="assignee-list-wrapper dropdown-border-listing-wrapper">
                    <ng-container *ngFor="let user of task?.userDetails">
                      <main-app-mat-chips
                        *ngIf="user && user.id !== loggedinUserid"
                        [indicateUserWorkingLocation]="true"
                        [data]="user"
                        [isCloseButton]="false"
                        [stopViewFullProfileOption]="true"
                        class="assignee-list"
                      >
                      </main-app-mat-chips>
                    </ng-container>
                  </div>
                </mat-menu>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-template>

<!-- This template used for no record found -->

<ng-template #noRecordsFound>
  <div class="task-table-wrapper no-records-wrapper">
    <div class="task-table-wrapper-inner">
      <div class="task-table" *ngIf="!isNoRecordFound && !showSpinner">
        <div class="task-row">
          <div class="task-cell no-records">No records found</div>
        </div>
      </div>
    </div>
  </div>
</ng-template>